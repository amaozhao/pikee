# PIKE-RAG ç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ

> åŸºäº LangGraph + FastAPI + Neo4j + Qdrant çš„ä¼ä¸šçº§çŸ¥è¯†å›¾è°± RAG ç³»ç»Ÿ

**ç‰ˆæœ¬**: 2.0 (æ•´åˆå¯é æ€§å¢å¼º)  
**Python ç‰ˆæœ¬**: 3.12+  
**æœ€åæ›´æ–°**: 2025å¹´

---

## ğŸ“‹ ç›®å½•

- [1. æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
- [2. æŠ€æœ¯é€‰å‹](#2-æŠ€æœ¯é€‰å‹)
- [3. æ ¸å¿ƒæ¶æ„](#3-æ ¸å¿ƒæ¶æ„)
- [4. å…³é”®æ”¹è¿›ç‚¹](#4-å…³é”®æ”¹è¿›ç‚¹)
- [5. å¯é æ€§ä¿éšœ](#5-å¯é æ€§ä¿éšœ)
- [6. é…ç½®ç®¡ç†](#6-é…ç½®ç®¡ç†)
- [7. é¡¹ç›®ç»“æ„](#7-é¡¹ç›®ç»“æ„)
- [8. å®æ–½è®¡åˆ’](#8-å®æ–½è®¡åˆ’)
- [9. è¯¦ç»†æ–‡æ¡£ç´¢å¼•](#9-è¯¦ç»†æ–‡æ¡£ç´¢å¼•)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

å°† PIKE-RAG çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆChunk-Atom åŒå±‚çŸ¥è¯†å›¾è°±ï¼‰æ”¹é€ ä¸ºç”Ÿäº§çº§ç³»ç»Ÿï¼š

- âœ… **API é©±åŠ¨**ï¼šé€šè¿‡ REST API å®æ—¶æ„å»ºå’ŒæŸ¥è¯¢çŸ¥è¯†åº“
- âœ… **å·¥ä½œæµç¼–æ’**ï¼šä½¿ç”¨ LangGraph å®ç°å¯è§†åŒ–çš„ Pipeline
- âœ… **æŒä¹…åŒ–å›¾è°±**ï¼šNeo4j å­˜å‚¨çŸ¥è¯†å›¾è°±ï¼ˆæ›¿ä»£å†…å­˜ NetworkXï¼‰
- âœ… **å‘é‡å­˜å‚¨**ï¼šQdrant é«˜æ€§èƒ½å‘é‡æ£€ç´¢
- âœ… **å¤šæ ¼å¼æ”¯æŒ**ï¼šPDF/DOCX/XLSX/PPTX/MD/JSON/TXT ç­‰ 9+ æ ¼å¼
- âœ… **é…ç½®ä¸­å¿ƒ**ï¼šApollo é›†ä¸­ç®¡ç†é…ç½®
- âœ… **é«˜å¯é æ€§**ï¼šé‡è¯•æœºåˆ¶ã€é”™è¯¯å¤„ç†ã€å…œåº•ç­–ç•¥

### 1.2 æ ¸å¿ƒæµç¨‹

```
æ–‡æ¡£ä¸Šä¼  â†’ æ–‡æ¡£è§£æ â†’ æ–‡æ¡£åˆ‡åˆ† â†’ Atomæå– 
    â†“
Neo4j å›¾è°±æ„å»º â† â†’ Qdrant å‘é‡å­˜å‚¨
    â†“
æ··åˆæ£€ç´¢ï¼ˆAtom + Chunkï¼‰ â†’ LLM ç”Ÿæˆç­”æ¡ˆ
```

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 æ ¸å¿ƒä¾èµ–

```toml
[tool.poetry.dependencies]
python = "*"

# ğŸ¯ æ ¸å¿ƒæ¡†æ¶
langgraph = "*"                          # å›¾å·¥ä½œæµ
fastapi = "*"                            # API æ¡†æ¶
uvicorn = {extras = ["standard"], version = "*"}

# ğŸ¯ LangChain ç”Ÿæ€
langchain = "*"
langchain-openai = "*"
langchain-community = "*"
langchain-core = "*"

# ğŸ¯ æ•°æ®åº“
qdrant-client = "*"                      # å‘é‡æ•°æ®åº“
neo4j = "*"                              # å›¾æ•°æ®åº“
redis = {extras = ["hiredis"], version = "*"}

# ğŸ¯ æ–‡æ¡£å¤„ç†
pypdf = "*"                              # PDF
python-docx = "*"                        # DOCX
openpyxl = "*"                           # Excel
python-pptx = "*"                        # PowerPoint
markdown = "*"                           # Markdown
unstructured = "*"                       # é€šç”¨æ–‡æ¡£è§£æ

# ğŸ¯ Embedding
fastembed = "*"                          # æœ¬åœ° Embedding

# ğŸ¯ é…ç½®å’Œå·¥å…·
pydantic = "*"                           # æ•°æ®éªŒè¯
pydantic-settings = "*"                  # é…ç½®ç®¡ç†
pyapollo = "*"                           # Apollo å®¢æˆ·ç«¯

# ğŸ¯ å¯é æ€§
tenacity = "*"                           # é‡è¯•æœºåˆ¶
python-json-logger = "*"                 # ç»“æ„åŒ–æ—¥å¿—
sentry-sdk = {extras = ["fastapi"], version = "*"}  # é”™è¯¯è¿½è¸ª

# ğŸ¯ ç›‘æ§
prometheus-client = "*"                  # Prometheus æŒ‡æ ‡
```

### 2.2 æœåŠ¡ä¾èµ–

```yaml
services:
  - FastAPI
  - Qdrant
  - Neo4j Community
  - Redis
  - Apollo Config Server
```

---

## 3. æ ¸å¿ƒæ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API å±‚ (FastAPI)                     â”‚
â”‚  /knowledge/build  |  /query/ask  |  /graph/subgraph   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LangGraph Pipeline å±‚                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ çŸ¥è¯†æ„å»º     â”‚  â”‚ æ£€ç´¢        â”‚  â”‚ é—®ç­”ç”Ÿæˆ    â”‚     â”‚
â”‚ â”‚ Pipeline    â”‚  â”‚ Pipeline    â”‚  â”‚ Pipeline    â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                          â”‚
â”‚ ğŸ”„ é‡è¯•æœºåˆ¶ | ğŸ“ çŠ¶æ€æŒä¹…åŒ– | âš ï¸ é”™è¯¯å¤„ç† | ğŸ›¡ï¸ å…œåº•   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                â”‚                â”‚               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚ Neo4j â”‚      â”‚  Qdrant   â”‚    â”‚  Redis  â”‚    â”‚ Apollo  â”‚
â”‚ å›¾è°±  â”‚      â”‚  å‘é‡åº“   â”‚    â”‚  ç¼“å­˜   â”‚    â”‚ é…ç½®ä¸­å¿ƒâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŸ¥è¯†å›¾è°±ç»“æ„ (Neo4j)

```cypher
// èŠ‚ç‚¹ç±»å‹
(:Document)-[:CONTAINS]->(:Chunk)-[:HAS_ATOM]->(:Atom)
(:Chunk)-[:SIMILAR_TO]->(:Chunk)
(:Entity)-[:MENTIONED_IN]->(:Chunk)
```

### 3.3 å‘é‡å­˜å‚¨ç»“æ„ (Qdrant)

```
Collection: pike_chunks
â”œâ”€â”€ vectors: Chunk å†…å®¹å‘é‡
â””â”€â”€ payload: {chunk_id, content, document_id, atoms}

Collection: pike_atoms
â”œâ”€â”€ vectors: Atom é—®é¢˜å‘é‡
â””â”€â”€ payload: {atom_text, source_chunk_id, document_id}
```

---

## 4. å…³é”®æ”¹è¿›ç‚¹

### 4.1 åŸé¡¹ç›® vs æ–°æ–¹æ¡ˆ

| ç»´åº¦ | åŸé¡¹ç›® | æ–°æ–¹æ¡ˆ | æ”¹è¿› |
|------|--------|--------|------|
| **å·¥ä½œæµ** | Python ç±»ç»§æ‰¿ | **LangGraph** | å¯è§†åŒ–ã€æ˜“è°ƒè¯• |
| **çŸ¥è¯†åº“æ„å»º** | ç¦»çº¿è„šæœ¬ | **FastAPI API** | å®æ—¶æ„å»ºã€æ˜“é›†æˆ |
| **å›¾è°±å­˜å‚¨** | NetworkX (å†…å­˜) | **Neo4j** | æŒä¹…åŒ–ã€Cypher æŸ¥è¯¢ |
| **å‘é‡åº“** | Chroma | **Qdrant** | æ€§èƒ½æ›´å¥½ã€ç”Ÿäº§çº§ |
| **æ–‡æ¡£æ ¼å¼** | 3 ç§ | **9+ ç§** | å…¨é¢æ”¯æŒ |
| **é…ç½®** | .env æ–‡ä»¶ | **Apollo** | é›†ä¸­ç®¡ç†ã€åŠ¨æ€åˆ·æ–° |
| **å¯é æ€§** | æ—  | **é‡è¯•+å…œåº•** | ç”Ÿäº§çº§ä¿éšœ |
| **æ—¥å¿—** | loguru | **logging** | æ ‡å‡†åº“ã€è½»é‡ |

### 4.2 LangGraph å·¥ä½œæµç¤ºä¾‹

```python
workflow = StateGraph(KnowledgeBuildingState)

# æ·»åŠ èŠ‚ç‚¹
workflow.add_node("load_document", load_document_node)
workflow.add_node("chunk_document", chunk_document_node)
workflow.add_node("extract_atoms", extract_atoms_node)
workflow.add_node("create_graph", create_graph_node)
workflow.add_node("store_vectors", store_vectors_node)

# æ·»åŠ è¾¹ï¼ˆå«é”™è¯¯å¤„ç†ï¼‰
workflow.add_conditional_edges(
    "load_document",
    should_continue,
    {"continue": "chunk_document", "error": "handle_error"}
)
```

è¯¦è§ï¼š[LangGraphå·¥ä½œæµå®ç°è¯¦è§£](./LangGraphå·¥ä½œæµå®ç°è¯¦è§£.md)

---

## 5. å¯é æ€§ä¿éšœ

### 5.1 æ ¸å¿ƒæœºåˆ¶

| æœºåˆ¶ | å®ç°æ–¹å¼ | é…ç½®é¡¹ |
|------|----------|--------|
| **é‡è¯•** | tenacity è£…é¥°å™¨ | `max_retry_attempts=3` |
| **æŒ‡æ•°é€€é¿** | wait_exponential | `retry_backoff_base=2.0` |
| **çŠ¶æ€æŒä¹…åŒ–** | Redis StateManager | æ¯ä¸ªèŠ‚ç‚¹åä¿å­˜ |
| **é”™è¯¯åˆ†ç±»** | RetryableError / FatalError | åŒºåˆ†å¯é‡è¯• |
| **é”™è¯¯è®°å½•** | ç»“æ„åŒ–æ—¥å¿— + Sentry | å®Œæ•´è¿½è¸ª |
| **å…œåº•ç­–ç•¥** | Fallback èŠ‚ç‚¹ | è§„åˆ™æå–ã€é™çº§ |

### 5.2 é”™è¯¯å¤„ç†æµç¨‹

```
èŠ‚ç‚¹æ‰§è¡Œ
   â†“
[æˆåŠŸ] â†’ ä¿å­˜çŠ¶æ€ â†’ ä¸‹ä¸€èŠ‚ç‚¹
   â†“
[å¤±è´¥] â†’ åˆ¤æ–­é”™è¯¯ç±»å‹
   â†“
[å¯é‡è¯•] â†’ é‡è¯•ï¼ˆæœ€å¤šNæ¬¡ï¼‰â†’ æŒ‡æ•°é€€é¿
   â†“
[è‡´å‘½é”™è¯¯] â†’ è®°å½•æ—¥å¿— â†’ å°è¯•å…œåº• â†’ æ ‡è®°å¤±è´¥
```

è¯¦è§ï¼š[å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£](./å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£.md)

---

## 6. é…ç½®ç®¡ç†

### 6.1 Apollo é…ç½®æ¶æ„

```
æœ¬åœ° .env (ä»… Apollo è¿æ¥ä¿¡æ¯)
    â†“
Apollo Config Service
    â†“
åº”ç”¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰é…ç½®
    â”œâ”€â”€ LLM é…ç½®
    â”œâ”€â”€ æ•°æ®åº“é…ç½®
    â”œâ”€â”€ ä¸šåŠ¡é…ç½®
    â””â”€â”€ ç‰¹æ€§å¼€å…³
    â†“
å®æ—¶ç›‘å¬é…ç½®å˜æ›´ï¼ˆå¯é€‰ï¼‰
```

### 6.2 æœ¬åœ°ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```bash
# ä»…ä¿å­˜ Apollo è¿æ¥ä¿¡æ¯
APOLLO_APP_ID=pike-rag
APOLLO_CLUSTER=default
APOLLO_META_SERVER=http://config.example.com:8080
APOLLO_NAMESPACE=application
APOLLO_SECRET=your-secret-key

# ç¯å¢ƒæ ‡è¯†
ENV=dev

# æœ¬åœ°å¼€å‘æ¨¡å¼ï¼ˆä¸è¿æ¥ Apolloï¼‰
LOCAL_DEV_MODE=false
```

### 6.3 Apollo ä¸­çš„é…ç½®

æ‰€æœ‰ä¸šåŠ¡é…ç½®éƒ½åœ¨ Apolloï¼š

```yaml
# LLM
openai_api_key: "sk-xxxxx"
openai_model: "gpt-4-turbo"

# æ•°æ®åº“
qdrant_url: "http://qdrant:6333"
neo4j_uri: "bolt://neo4j:7687"

# é‡è¯•é…ç½®
max_retry_attempts: 3
retry_backoff_base: 2.0
```

è¯¦è§ï¼š[Apolloé…ç½®ç®¡ç†è¯¦è§£](./Apolloé…ç½®ç®¡ç†è¯¦è§£.md)

---

## 7. é¡¹ç›®ç»“æ„

### 7.1 è®¾è®¡ç†å¿µ

é¡¹ç›®é‡‡ç”¨**åŠŸèƒ½æ¨¡å—åŒ–**è®¾è®¡ï¼ŒæŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

- **`pipeline/`** - æ•°æ®å¤„ç†æ¨¡å—ï¼ˆæ–‡æ¡£åŠ è½½â†’åˆ‡åˆ†â†’Atomæå–â†’å›¾è°±æ„å»ºï¼‰
- **`retrieval/`** - æ£€ç´¢æ¨¡å—ï¼ˆå‘é‡æ£€ç´¢â†’å›¾è°±æ£€ç´¢â†’æ··åˆæ£€ç´¢â†’é‡æ’åºï¼‰
- **`api/`** - æ¥å£å±‚ï¼ˆè–„å±‚ï¼Œåªè´Ÿè´£è·¯ç”±å’Œè°ƒç”¨ï¼‰
- **`infrastructure/`** - åŸºç¡€è®¾æ–½å±‚ï¼ˆæ•°æ®åº“è¿æ¥ã€LLMå®¢æˆ·ç«¯ã€å·¥å…·ç±»ï¼‰

æ¯ä¸ªæ¨¡å—éƒ½æ˜¯è‡ªåŒ…å«çš„ï¼Œæ‹¥æœ‰è‡ªå·±çš„ workflowsã€servicesã€modelsï¼Œé™ä½è€¦åˆåº¦ï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚

### 7.2 å®Œæ•´ç›®å½•ç»“æ„

```
ragee/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                                  # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.py                                # å…¨å±€é…ç½®ï¼ˆApollo + Pydantic Settingsï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                                     # ğŸ¯ API å±‚ï¼ˆè–„å±‚ï¼Œä»…è´Ÿè´£è·¯ç”±ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dependencies.py                      # FastAPI ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ knowledge.py                     # çŸ¥è¯†åº“ç®¡ç†æ¥å£
â”‚   â”‚       â”œâ”€â”€ query.py                         # æŸ¥è¯¢é—®ç­”æ¥å£
â”‚   â”‚       â””â”€â”€ graph.py                         # å›¾è°±æŸ¥è¯¢æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ pipeline/                                # ğŸ¯ Pipeline æ¨¡å—ï¼ˆæ•°æ®å¤„ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ workflows/                           # LangGraph å·¥ä½œæµ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge_building.py            # çŸ¥è¯†åº“æ„å»ºå·¥ä½œæµ
â”‚   â”‚   â”‚   â””â”€â”€ document_processing.py           # æ–‡æ¡£å¤„ç†å·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ services/                            # Pipeline ä¸“ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ document_loader.py               # æ–‡æ¡£åŠ è½½å™¨ï¼ˆ9+æ ¼å¼ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ chunking.py                      # æ–‡æ¡£åˆ‡åˆ†æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ atom_extractor.py                # Atom æå–æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ graph_builder.py                 # å›¾è°±æ„å»ºæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ models/                              # Pipeline æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ document.py                      # æ–‡æ¡£æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ chunk.py                         # Chunk æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ atom.py                          # Atom æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/                               # Pipeline å·¥å…·
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ text_processor.py                # æ–‡æœ¬å¤„ç†å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ retrieval/                               # ğŸ¯ æ£€ç´¢æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ workflows/                           # æ£€ç´¢å·¥ä½œæµ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ hybrid_retrieval.py              # æ··åˆæ£€ç´¢å·¥ä½œæµ
â”‚   â”‚   â”‚   â””â”€â”€ qa_pipeline.py                   # é—®ç­”å·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ services/                            # æ£€ç´¢ä¸“ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ vector_store.py                  # Qdrant å‘é‡æ£€ç´¢æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ graph_store.py                   # Neo4j å›¾è°±æ£€ç´¢æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ reranker.py                      # ç»“æœé‡æ’åºæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ models/                              # æ£€ç´¢æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ query.py                         # æŸ¥è¯¢è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ result.py                        # æ£€ç´¢ç»“æœæ¨¡å‹
â”‚   â”‚   â””â”€â”€ strategies/                          # æ£€ç´¢ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ atom_retrieval.py                # Atom æ£€ç´¢ç­–ç•¥
â”‚   â”‚       â””â”€â”€ chunk_retrieval.py               # Chunk æ£€ç´¢ç­–ç•¥
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/                          # ğŸ¯ åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ database/                            # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ qdrant.py                        # Qdrant å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ neo4j.py                         # Neo4j é©±åŠ¨
â”‚   â”‚   â”‚   â””â”€â”€ redis.py                         # Redis å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ llm/                                 # LLM ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ client.py                        # LLM å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”œâ”€â”€ error_handler.py                     # ç»Ÿä¸€é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ state_manager.py                     # çŠ¶æ€ç®¡ç†ï¼ˆRedisï¼‰
â”‚   â”‚   â””â”€â”€ utils/                               # é€šç”¨å·¥å…·
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ logger.py                        # æ—¥å¿—é…ç½®
â”‚   â”‚       â”œâ”€â”€ retry.py                         # é‡è¯•è£…é¥°å™¨
â”‚   â”‚       â””â”€â”€ metrics.py                       # Prometheus æŒ‡æ ‡
â”‚   â”‚
â”‚   â””â”€â”€ models/                                  # å…¨å±€æ•°æ®æ¨¡å‹
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ api_models.py                        # API è¯·æ±‚/å“åº”æ¨¡å‹
â”‚       â””â”€â”€ graph.py                             # å›¾è°±é€šç”¨æ¨¡å‹
â”‚
â”œâ”€â”€ tests/                                       # æµ‹è¯•ï¼ˆæŒ‰æ¨¡å—ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_api/                                # API æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ test_routes.py
â”‚   â”œâ”€â”€ test_pipeline/                           # Pipeline æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_workflows.py
â”‚   â”‚   â””â”€â”€ test_services.py
â”‚   â””â”€â”€ test_retrieval/                          # æ£€ç´¢æµ‹è¯•
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ test_strategies.py
â”‚       â””â”€â”€ test_workflows.py
â”‚
â”œâ”€â”€ docs/                                        # æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml                           # Docker æœåŠ¡ç¼–æ’
â”œâ”€â”€ Dockerfile                                   # å®¹å™¨æ„å»ºæ–‡ä»¶
â”œâ”€â”€ pyproject.toml                               # Poetry ä¾èµ–ç®¡ç†
â””â”€â”€ README.md                                    # é¡¹ç›®è¯´æ˜
```

### 7.3 æ¨¡å—èŒè´£è¯´æ˜

| æ¨¡å— | èŒè´£ | æ ¸å¿ƒæ–‡ä»¶ |
|------|------|---------|
| **api/** | HTTP æ¥å£å±‚ï¼Œæ¥æ”¶è¯·æ±‚å¹¶è°ƒç”¨ pipeline æˆ– retrieval | `routes/*.py` |
| **pipeline/** | æ–‡æ¡£å¤„ç†å…¨æµç¨‹ï¼šåŠ è½½â†’åˆ‡åˆ†â†’æå–â†’æ„å»ºå›¾è°± | `workflows/knowledge_building.py` |
| **retrieval/** | æ£€ç´¢å…¨æµç¨‹ï¼šå‘é‡æ£€ç´¢â†’å›¾è°±æ£€ç´¢â†’æ··åˆâ†’é‡æ’ | `workflows/hybrid_retrieval.py` |
| **infrastructure/** | åŸºç¡€è®¾æ–½å±‚ï¼šæ•°æ®åº“è¿æ¥ã€LLMå®¢æˆ·ç«¯ã€æ—¥å¿—ã€é‡è¯• | `database/*.py`, `llm/client.py` |
| **models/** | å…¨å±€é€šç”¨æ•°æ®æ¨¡å‹ | `api_models.py`, `graph.py` |

### 7.4 è°ƒç”¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API å±‚    â”‚
â”‚  (routes)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pipeline   â”‚  â”‚  Retrieval  â”‚
â”‚   æ¨¡å—      â”‚  â”‚    æ¨¡å—     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Infrastructure   â”‚
        â”‚   åŸºç¡€è®¾æ–½å±‚     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 è®¾è®¡ä¼˜åŠ¿

âœ… **é«˜å†…èš**ï¼šæ¯ä¸ªæ¨¡å—åŒ…å«è‡ªå·±çš„ workflowsã€servicesã€models
âœ… **ä½è€¦åˆ**ï¼šæ¨¡å—é—´é€šè¿‡æ˜ç¡®çš„æ¥å£äº¤äº’
âœ… **æ˜“æ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½åªéœ€åœ¨å¯¹åº”æ¨¡å—å†…æ·»åŠ 
âœ… **æ˜“æµ‹è¯•**ï¼šæµ‹è¯•ç»“æ„ä¸ä»£ç ç»“æ„ä¸€ä¸€å¯¹åº”
âœ… **æ¸…æ™°**ï¼šä¸€çœ¼å°±èƒ½çœ‹å‡ºé¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

---

## 8. å®æ–½è®¡åˆ’

### 8.1 å¼€å‘é˜¶æ®µ

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ | è¾“å‡º |
|------|------|------|------|
| **Phase 1** | ç¯å¢ƒæ­å»º | 1 å¤© | Docker Compose + Poetry ç¯å¢ƒ |
| **Phase 2** | é…ç½®ç®¡ç† | 1 å¤© | Apollo é›†æˆ + pydantic-settings |
| **Phase 3** | æ–‡æ¡£å¤„ç† | 2 å¤© | 9+ æ ¼å¼åŠ è½½å™¨ + åˆ‡åˆ†æœåŠ¡ |
| **Phase 4** | Atom æå– | 1 å¤© | LLM Atom æå–æœåŠ¡ |
| **Phase 5** | Neo4j é›†æˆ | 2 å¤© | å›¾è°±æ„å»º + Cypher æŸ¥è¯¢ |
| **Phase 6** | Qdrant é›†æˆ | 2 å¤© | å‘é‡å­˜å‚¨ + æ··åˆæ£€ç´¢ |
| **Phase 7** | LangGraph Pipeline | 3 å¤© | çŸ¥è¯†æ„å»º + QA Pipeline |
| **Phase 8** | å¯é æ€§å¢å¼º | 2 å¤© | é‡è¯• + é”™è¯¯å¤„ç† + å…œåº• |
| **Phase 9** | API å¼€å‘ | 2 å¤© | FastAPI æ¥å£ |
| **Phase 10** | æµ‹è¯•ä¼˜åŒ– | 2 å¤© | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• |
| **æ€»è®¡** | - | **18-20 å¤©** | ç”Ÿäº§çº§ç³»ç»Ÿ |

### 8.2 éƒ¨ç½²æµç¨‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repo>
cd pike_rag_v2

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å†™ Apollo åœ°å€

# 3. ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 4. è®¿é—®æœåŠ¡
# API: http://localhost:8000/docs
# Neo4j: http://localhost:7474
# Qdrant: http://localhost:6333/dashboard
```

---

## 9. è¯¦ç»†æ–‡æ¡£ç´¢å¼•

### 9.1 æ¶æ„è®¾è®¡

- [LangGraphå·¥ä½œæµå®ç°è¯¦è§£](./LangGraphå·¥ä½œæµå®ç°è¯¦è§£.md) - Pipeline è®¾è®¡ä¸å®ç°
- [Neo4jçŸ¥è¯†å›¾è°±è®¾è®¡è¯¦è§£](./Neo4jçŸ¥è¯†å›¾è°±è®¾è®¡è¯¦è§£.md) - å›¾æ¨¡å‹ä¸ Cypher æŸ¥è¯¢
- [Qdrantå‘é‡å­˜å‚¨è¯¦è§£](./Qdrantå‘é‡å­˜å‚¨è¯¦è§£.md) - å‘é‡æ£€ç´¢ä¸æ··åˆæŸ¥è¯¢

### 9.2 æ ¸å¿ƒåŠŸèƒ½

- [æ–‡æ¡£åŠ è½½å™¨å®ç°](./æ–‡æ¡£åŠ è½½å™¨å®ç°.md) - 9+ æ ¼å¼æ”¯æŒ
- [Atomæå–æœåŠ¡è¯¦è§£](./Atomæå–æœåŠ¡è¯¦è§£.md) - LLM æå–åŸå­é—®é¢˜
- [æ··åˆæ£€ç´¢ç­–ç•¥](./æ··åˆæ£€ç´¢ç­–ç•¥.md) - Atom + Chunk æ£€ç´¢

### 9.3 å¯é æ€§ä¸é…ç½®

- [å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£](./å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£.md) - é‡è¯•ã€é”™è¯¯å¤„ç†ã€å…œåº•
- [Apolloé…ç½®ç®¡ç†è¯¦è§£](./Apolloé…ç½®ç®¡ç†è¯¦è§£.md) - é›†ä¸­é…ç½®ä¸åŠ¨æ€åˆ·æ–°
- [ç›‘æ§ä¸å‘Šè­¦](./ç›‘æ§ä¸å‘Šè­¦.md) - Prometheus + Sentry

### 9.4 éƒ¨ç½²ä¸è¿ç»´

- [Dockeréƒ¨ç½²æŒ‡å—](./Dockeréƒ¨ç½²æŒ‡å—.md) - ä¸€é”®éƒ¨ç½²
- [ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–](./ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–.md) - æ€§èƒ½è°ƒä¼˜
- [å¸¸è§é—®é¢˜FAQ](./å¸¸è§é—®é¢˜FAQ.md) - æ•…éšœæ’æŸ¥

---

## 10. å¿«é€Ÿå¼€å§‹

### 10.1 æœ€å°å¯è¿è¡Œç¤ºä¾‹

1. **å®‰è£…ä¾èµ–**

```bash
poetry install
```

2. **å¯åŠ¨æœåŠ¡**

```bash
docker-compose up -d qdrant neo4j redis
```

3. **è¿è¡Œ API**

```bash
poetry run python -m app.main
```

4. **ä¸Šä¼ æ–‡æ¡£æ„å»ºçŸ¥è¯†åº“**

```bash
curl -X POST "http://localhost:8000/api/v1/knowledge/build" \
     -H "Content-Type: multipart/form-data" \
     -F "file=@sample.pdf"
```

5. **æŸ¥è¯¢é—®ç­”**

```bash
curl -X POST "http://localhost:8000/api/v1/query/ask" \
     -H "Content-Type: application/json" \
     -d '{"question": "ä»€ä¹ˆæ˜¯PIKE-RAGï¼Ÿ"}'
```

---

## 11. æ€»ç»“

### 11.1 æ ¸å¿ƒä¼˜åŠ¿

âœ… **ç”Ÿäº§çº§æ¶æ„**ï¼šLangGraph + FastAPI + Neo4j + Qdrant  
âœ… **é«˜å¯é æ€§**ï¼šé‡è¯•æœºåˆ¶ + é”™è¯¯å¤„ç† + å…œåº•ç­–ç•¥  
âœ… **é…ç½®ä¸­å¿ƒ**ï¼šApollo é›†ä¸­ç®¡ç†ï¼ŒåŠ¨æ€åˆ·æ–°  
âœ… **å®Œæ•´ç›‘æ§**ï¼šPrometheus æŒ‡æ ‡ + Sentry è¿½è¸ª  
âœ… **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ¸…æ™°çš„é¡¹ç›®ç»“æ„  
âœ… **å¼€ç®±å³ç”¨**ï¼šDocker Compose ä¸€é”®éƒ¨ç½²

### 11.2 é€‚ç”¨åœºæ™¯

- ä¼ä¸šçº§çŸ¥è¯†åº“ç³»ç»Ÿ
- æ™ºèƒ½å®¢æœé—®ç­”
- æ–‡æ¡£é—®ç­”åŠ©æ‰‹
- çŸ¥è¯†å›¾è°±æ£€ç´¢

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0 (Final)  
**Python ç‰ˆæœ¬**: 3.12+  
**æ¨èæŒ‡æ•°**: â­â­â­â­â­

å¦‚éœ€è¯¦ç»†å®ç°ï¼Œè¯·å‚è€ƒ[è¯¦ç»†æ–‡æ¡£ç´¢å¼•](#9-è¯¦ç»†æ–‡æ¡£ç´¢å¼•)ã€‚

