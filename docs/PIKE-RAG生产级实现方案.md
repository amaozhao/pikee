# PIKE-RAG ç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ

> åŸºäº Prefect + FastAPI + Neo4j + Qdrant çš„ä¼ä¸šçº§çŸ¥è¯†å›¾è°± RAG ç³»ç»Ÿ

**ç‰ˆæœ¬**: 2.1 (Prefect Pipeline)  
**Python ç‰ˆæœ¬**: 3.12+  
**æœ€åæ›´æ–°**: 2025å¹´

---

## ğŸ“‹ ç›®å½•

- [1. æ–¹æ¡ˆæ¦‚è¿°](#1-æ–¹æ¡ˆæ¦‚è¿°)
- [2. æŠ€æœ¯é€‰å‹](#2-æŠ€æœ¯é€‰å‹)
- [3. æ ¸å¿ƒæ¶æ„](#3-æ ¸å¿ƒæ¶æ„)
- [4. å…³é”®æ”¹è¿›ç‚¹](#4-å…³é”®æ”¹è¿›ç‚¹)
- [5. å¯é æ€§ä¿éšœ](#5-å¯é æ€§ä¿éšœ)
- [6. é…ç½®ç®¡ç†](#6-é…ç½®ç®¡ç†)
- [7. é¡¹ç›®ç»“æ„](#7-é¡¹ç›®ç»“æ„)
- [8. å®æ–½è®¡åˆ’](#8-å®æ–½è®¡åˆ’)
- [9. è¯¦ç»†æ–‡æ¡£ç´¢å¼•](#9-è¯¦ç»†æ–‡æ¡£ç´¢å¼•)

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

å°† PIKE-RAG çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆChunk-Atom åŒå±‚çŸ¥è¯†å›¾è°±ï¼‰æ”¹é€ ä¸ºç”Ÿäº§çº§ç³»ç»Ÿï¼š

- âœ… **API é©±åŠ¨**ï¼šé€šè¿‡ REST API å®æ—¶æ„å»ºå’ŒæŸ¥è¯¢çŸ¥è¯†åº“
- âœ… **å·¥ä½œæµç¼–æ’**ï¼šä½¿ç”¨ Prefect å®ç°ç¨³å¥çš„ Pipelineï¼ˆè‡ªåŠ¨é‡è¯•ã€çŠ¶æ€ç®¡ç†ã€ç›‘æ§ UIï¼‰
- âœ… **æŒä¹…åŒ–å›¾è°±**ï¼šNeo4j å­˜å‚¨çŸ¥è¯†å›¾è°±ï¼ˆæ›¿ä»£å†…å­˜ NetworkXï¼‰
- âœ… **å‘é‡å­˜å‚¨**ï¼šQdrant é«˜æ€§èƒ½å‘é‡æ£€ç´¢
- âœ… **å¤šæ ¼å¼æ”¯æŒ**ï¼šPDF/DOCX/XLSX/PPTX/MD/JSON/TXT ç­‰ 9+ æ ¼å¼
- âœ… **é…ç½®ä¸­å¿ƒ**ï¼šApollo é›†ä¸­ç®¡ç†é…ç½®
- âœ… **é«˜å¯é æ€§**ï¼šPrefect å†…ç½®é‡è¯•ã€çŠ¶æ€æŒä¹…åŒ–ã€æ–­ç‚¹ç»­ä¼ 

### 1.2 æ ¸å¿ƒæµç¨‹

```
æ–‡æ¡£ä¸Šä¼  â†’ æ–‡æ¡£è§£æ â†’ æ–‡æ¡£åˆ‡åˆ† â†’ Atomæå– 
    â†“
Neo4j å›¾è°±æ„å»º â† â†’ Qdrant å‘é‡å­˜å‚¨
    â†“
æ··åˆæ£€ç´¢ï¼ˆAtom + Chunkï¼‰ â†’ LLM ç”Ÿæˆç­”æ¡ˆ
```

---

## 2. æŠ€æœ¯é€‰å‹

### 2.1 æ ¸å¿ƒä¾èµ–

```toml
[tool.poetry.dependencies]
python = "*"

# ğŸ¯ æ ¸å¿ƒæ¡†æ¶
prefect = ">=2.0"                        # å·¥ä½œæµç¼–æ’ï¼ˆç”Ÿäº§çº§ï¼‰
fastapi = "*"                            # API æ¡†æ¶
uvicorn = {extras = ["standard"], version = "*"}

# ğŸ¯ LangChain ç”Ÿæ€
langchain = "*"
langchain-openai = "*"
langchain-community = "*"
langchain-core = "*"

# ğŸ¯ æ•°æ®åº“
qdrant-client = "*"                      # å‘é‡æ•°æ®åº“
neo4j = "*"                              # å›¾æ•°æ®åº“
redis = {extras = ["hiredis"], version = "*"}

# ğŸ¯ æ–‡æ¡£å¤„ç†
pypdf = "*"                              # PDF
python-docx = "*"                        # DOCX
openpyxl = "*"                           # Excel
python-pptx = "*"                        # PowerPoint
markdown = "*"                           # Markdown
unstructured = "*"                       # é€šç”¨æ–‡æ¡£è§£æ

# ğŸ¯ Embedding
fastembed = "*"                          # æœ¬åœ° Embedding

# ğŸ¯ é…ç½®å’Œå·¥å…·
pydantic = "*"                           # æ•°æ®éªŒè¯
pydantic-settings = "*"                  # é…ç½®ç®¡ç†
pyapollo = "*"                           # Apollo å®¢æˆ·ç«¯

# ğŸ¯ å¯é æ€§
tenacity = "*"                           # é‡è¯•æœºåˆ¶
python-json-logger = "*"                 # ç»“æ„åŒ–æ—¥å¿—
sentry-sdk = {extras = ["fastapi"], version = "*"}  # é”™è¯¯è¿½è¸ª

# ğŸ¯ ç›‘æ§
prometheus-client = "*"                  # Prometheus æŒ‡æ ‡
```

### 2.2 æœåŠ¡ä¾èµ–

```yaml
services:
  - FastAPI
  - Prefect Server (å¼€æºç‰ˆ)
  - Qdrant
  - Neo4j Community
  - Redis
  - Apollo Config Server
```

---

## 3. æ ¸å¿ƒæ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API å±‚ (FastAPI)                     â”‚
â”‚  /knowledge/build  |  /query/ask  |  /graph/subgraph   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Prefect Pipeline å±‚                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ â”‚ çŸ¥è¯†æ„å»º     â”‚  â”‚ æ£€ç´¢        â”‚  â”‚ é—®ç­”ç”Ÿæˆ    â”‚     â”‚
â”‚ â”‚ Flow        â”‚  â”‚ Flow        â”‚  â”‚ Flow        â”‚     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                          â”‚
â”‚ ğŸ”„ è‡ªåŠ¨é‡è¯• | ğŸ“ çŠ¶æ€æŒä¹…åŒ– | ğŸ“Š Webç›‘æ§ | ğŸ” æ–­ç‚¹ç»­ä¼  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
    â”‚                â”‚                â”‚              â”‚    â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ–¼â”€â”€â”€â”€â”€â”
â”‚ Neo4j â”‚      â”‚  Qdrant   â”‚    â”‚ Prefect â”‚  â”‚  Redis â”‚ â”‚Apolloâ”‚
â”‚ å›¾è°±  â”‚      â”‚  å‘é‡åº“   â”‚    â”‚ Server  â”‚  â”‚  ç¼“å­˜  â”‚ â”‚ é…ç½® â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 çŸ¥è¯†å›¾è°±ç»“æ„ (Neo4j)

```cypher
// èŠ‚ç‚¹ç±»å‹
(:Document)-[:CONTAINS]->(:Chunk)-[:HAS_ATOM]->(:Atom)
(:Chunk)-[:SIMILAR_TO]->(:Chunk)
(:Entity)-[:MENTIONED_IN]->(:Chunk)
```

### 3.3 å‘é‡å­˜å‚¨ç»“æ„ (Qdrant)

```
Collection: pike_chunks
â”œâ”€â”€ vectors: Chunk å†…å®¹å‘é‡
â””â”€â”€ payload: {chunk_id, content, document_id, atoms}

Collection: pike_atoms
â”œâ”€â”€ vectors: Atom é—®é¢˜å‘é‡
â””â”€â”€ payload: {atom_text, source_chunk_id, document_id}
```

---

## 4. å…³é”®æ”¹è¿›ç‚¹

### 4.1 åŸé¡¹ç›® vs æ–°æ–¹æ¡ˆ

| ç»´åº¦ | åŸé¡¹ç›® | æ–°æ–¹æ¡ˆ | æ”¹è¿› |
|------|--------|--------|------|
| **å·¥ä½œæµ** | Python ç±»ç»§æ‰¿ | **Prefect** | ä¼ä¸šçº§ç¨³å®šæ€§ã€è‡ªåŠ¨é‡è¯•ã€çŠ¶æ€æŒä¹…åŒ– |
| **çŸ¥è¯†åº“æ„å»º** | ç¦»çº¿è„šæœ¬ | **FastAPI API** | å®æ—¶æ„å»ºã€æ˜“é›†æˆ |
| **å›¾è°±å­˜å‚¨** | NetworkX (å†…å­˜) | **Neo4j** | æŒä¹…åŒ–ã€Cypher æŸ¥è¯¢ |
| **å‘é‡åº“** | Chroma | **Qdrant** | æ€§èƒ½æ›´å¥½ã€ç”Ÿäº§çº§ |
| **æ–‡æ¡£æ ¼å¼** | 3 ç§ | **9+ ç§** | å…¨é¢æ”¯æŒ |
| **é…ç½®** | .env æ–‡ä»¶ | **Apollo** | é›†ä¸­ç®¡ç†ã€åŠ¨æ€åˆ·æ–° |
| **å¯é æ€§** | æ—  | **Prefectå†…ç½®** | è‡ªåŠ¨é‡è¯•ã€æ–­ç‚¹ç»­ä¼ ã€Webç›‘æ§ |
| **æ—¥å¿—** | loguru | **logging** | æ ‡å‡†åº“ã€è½»é‡ |

### 4.2 Prefect å·¥ä½œæµç¤ºä¾‹

```python
from prefect import flow, task

@task(retries=3, retry_delay_seconds=5)
def load_document(file_path: str) -> Document:
    """åŠ è½½æ–‡æ¡£ï¼ˆè‡ªåŠ¨é‡è¯•3æ¬¡ï¼‰."""
    loader = DocumentLoader()
    return loader.load(file_path)

@task(retries=3)
def chunk_document(document: Document) -> List[Chunk]:
    """åˆ‡åˆ†æ–‡æ¡£."""
    chunker = DocumentChunker(settings)
    return chunker.chunk_document(document)

@task(retries=2)
def extract_atoms(chunks: List[Chunk]) -> List[Atom]:
    """æå–åŸå­é—®é¢˜."""
    extractor = AtomExtractor(settings, llm_client)
    return extractor.extract_atoms_from_chunks(chunks)

@task(retries=3)
def build_vector_store(chunks: List[Chunk], atoms: List[Atom]) -> bool:
    """æ„å»ºå‘é‡å­˜å‚¨."""
    builder = VectorDatabaseBuilder(settings, qdrant_client, embedder)
    return builder.build_all(chunks, atoms)

@flow(name="Document Processing Pipeline", retries=1)
def document_processing_pipeline(file_path: str):
    """æ–‡æ¡£å¤„ç†ä¸»æµç¨‹ï¼ˆPrefect Flowï¼‰."""
    document = load_document(file_path)
    chunks = chunk_document(document)
    atoms = extract_atoms(chunks)
    success = build_vector_store(chunks, atoms)
    return {"success": success, "chunks": len(chunks), "atoms": len(atoms)}
```

**Prefect ä¼˜åŠ¿**ï¼š
- âœ… è‡ªåŠ¨é‡è¯•å’ŒçŠ¶æ€æŒä¹…åŒ–
- âœ… Web UI å®æ—¶ç›‘æ§ï¼ˆhttp://localhost:4200ï¼‰
- âœ… æ–­ç‚¹ç»­ä¼ ï¼ˆå¤±è´¥åå¯ä»ä¸­æ–­ç‚¹ç»§ç»­ï¼‰
- âœ… å¹¶å‘æ§åˆ¶å’Œèµ„æºç®¡ç†
- âœ… å®Œæ•´çš„æ‰§è¡Œå†å²å’Œæ—¥å¿—

---

## 5. å¯é æ€§ä¿éšœï¼ˆPrefect ç»Ÿä¸€ç®¡ç†ï¼‰

### 5.1 æ ¸å¿ƒæœºåˆ¶

| æœºåˆ¶ | å®ç°æ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| **è‡ªåŠ¨é‡è¯•** | Prefect Task `retries` å‚æ•° | `@task(retries=3)` |
| **æŒ‡æ•°é€€é¿** | Prefect å†…ç½®ç­–ç•¥ | è‡ªåŠ¨å¤„ç†é‡è¯•å»¶è¿Ÿ |
| **çŠ¶æ€æŒä¹…åŒ–** | Prefect Backend | è‡ªåŠ¨ä¿å­˜ Flow/Task çŠ¶æ€ |
| **æ‰§è¡Œå†å²** | Prefect Database | å®Œæ•´çš„æ‰§è¡Œè®°å½•å’Œæ—¥å¿— |
| **é”™è¯¯è¿½è¸ª** | Prefect UI + Logger | Web ç•Œé¢å®æ—¶ç›‘æ§ |
| **æ–­ç‚¹ç»­ä¼ ** | Prefect Flow Resume | ä»å¤±è´¥ç‚¹ç»§ç»­æ‰§è¡Œ |

### 5.2 Prefect é”™è¯¯å¤„ç†æµç¨‹

```
Task æ‰§è¡Œ
   â†“
[æˆåŠŸ] â†’ Prefect è‡ªåŠ¨ä¿å­˜çŠ¶æ€ â†’ ä¸‹ä¸€ Task
   â†“
[å¤±è´¥] â†’ Prefect åˆ¤æ–­æ˜¯å¦é‡è¯•
   â†“
[å¯é‡è¯•] â†’ è‡ªåŠ¨é‡è¯•ï¼ˆæœ€å¤š N æ¬¡ï¼‰â†’ æŒ‡æ•°é€€é¿
   â†“
[é‡è¯•å¤±è´¥] â†’ æ ‡è®° Task å¤±è´¥ â†’ è®°å½•æ—¥å¿— â†’ Flow å¤±è´¥æˆ–ç»§ç»­
   â†“
[Flow å¤±è´¥] â†’ å¯é€šè¿‡ UI æ‰‹åŠ¨é‡å¯æˆ–è‡ªåŠ¨é‡å¯
```

**ä¼˜åŠ¿**ï¼š
- âœ… **æ— éœ€è‡ªå®šä¹‰çŠ¶æ€ç®¡ç†**ï¼šPrefect å†…ç½®çŠ¶æ€æŒä¹…åŒ–
- âœ… **æ— éœ€æ‰‹åŠ¨é”™è¯¯å¤„ç†**ï¼šTask è£…é¥°å™¨è‡ªåŠ¨å¤„ç†é‡è¯•å’Œé”™è¯¯
- âœ… **å¯è§†åŒ–ç›‘æ§**ï¼šWeb UI å®æ—¶æŸ¥çœ‹æ‰§è¡ŒçŠ¶æ€å’Œæ—¥å¿—
- âœ… **ç”Ÿäº§çº§å¯é æ€§**ï¼šç»è¿‡å¤§è§„æ¨¡éªŒè¯çš„å·¥ä½œæµå¼•æ“

---

## 6. é…ç½®ç®¡ç†

### 6.1 Apollo é…ç½®æ¶æ„

```
æœ¬åœ° .env (ä»… Apollo è¿æ¥ä¿¡æ¯)
    â†“
Apollo Config Service
    â†“
åº”ç”¨å¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰é…ç½®
    â”œâ”€â”€ LLM é…ç½®
    â”œâ”€â”€ æ•°æ®åº“é…ç½®
    â”œâ”€â”€ ä¸šåŠ¡é…ç½®
    â””â”€â”€ ç‰¹æ€§å¼€å…³
    â†“
å®æ—¶ç›‘å¬é…ç½®å˜æ›´ï¼ˆå¯é€‰ï¼‰
```

### 6.2 æœ¬åœ°ç¯å¢ƒå˜é‡ï¼ˆ.envï¼‰

```bash
# ä»…ä¿å­˜ Apollo è¿æ¥ä¿¡æ¯
APOLLO_APP_ID=pike-rag
APOLLO_CLUSTER=default
APOLLO_META_SERVER=http://config.example.com:8080
APOLLO_NAMESPACE=application
APOLLO_SECRET=your-secret-key

# ç¯å¢ƒæ ‡è¯†
ENV=dev

# æœ¬åœ°å¼€å‘æ¨¡å¼ï¼ˆä¸è¿æ¥ Apolloï¼‰
LOCAL_DEV_MODE=false
```

### 6.3 Apollo ä¸­çš„é…ç½®

æ‰€æœ‰ä¸šåŠ¡é…ç½®éƒ½åœ¨ Apolloï¼š

```yaml
# LLM
openai_api_key: "sk-xxxxx"
openai_model: "gpt-4-turbo"

# æ•°æ®åº“
qdrant_url: "http://qdrant:6333"
neo4j_uri: "bolt://neo4j:7687"

# é‡è¯•é…ç½®
max_retry_attempts: 3
retry_backoff_base: 2.0
```

è¯¦è§ï¼š[Apolloé…ç½®ç®¡ç†è¯¦è§£](./Apolloé…ç½®ç®¡ç†è¯¦è§£.md)

---

## 7. é¡¹ç›®ç»“æ„

### 7.1 è®¾è®¡ç†å¿µ

é¡¹ç›®é‡‡ç”¨**åŠŸèƒ½æ¨¡å—åŒ–**è®¾è®¡ï¼ŒæŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š

- **`pipeline/`** - æ•°æ®å¤„ç†æ¨¡å—ï¼ˆæ–‡æ¡£åŠ è½½â†’åˆ‡åˆ†â†’Atomæå–â†’å›¾è°±æ„å»ºï¼‰
- **`retrieval/`** - æ£€ç´¢æ¨¡å—ï¼ˆå‘é‡æ£€ç´¢â†’å›¾è°±æ£€ç´¢â†’æ··åˆæ£€ç´¢â†’é‡æ’åºï¼‰
- **`api/`** - æ¥å£å±‚ï¼ˆè–„å±‚ï¼Œåªè´Ÿè´£è·¯ç”±å’Œè°ƒç”¨ï¼‰
- **`infrastructure/`** - åŸºç¡€è®¾æ–½å±‚ï¼ˆæ•°æ®åº“è¿æ¥ã€LLMå®¢æˆ·ç«¯ã€å·¥å…·ç±»ï¼‰

æ¯ä¸ªæ¨¡å—éƒ½æ˜¯è‡ªåŒ…å«çš„ï¼Œæ‹¥æœ‰è‡ªå·±çš„ workflowsã€servicesã€modelsï¼Œé™ä½è€¦åˆåº¦ï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚

### 7.2 å®Œæ•´ç›®å½•ç»“æ„

```
pikee/
â”œâ”€â”€ pikee/                                       # ä¸»åº”ç”¨ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                                  # FastAPI åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ api/                                     # ğŸ¯ HTTP API å±‚ï¼ˆFastAPIï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ dependencies.py                      # FastAPI ä¾èµ–æ³¨å…¥
â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ knowledge.py                     # çŸ¥è¯†åº“ç®¡ç†æ¥å£
â”‚   â”‚       â”œâ”€â”€ query.py                         # æŸ¥è¯¢é—®ç­”æ¥å£
â”‚   â”‚       â””â”€â”€ graph.py                         # å›¾è°±æŸ¥è¯¢æ¥å£
â”‚   â”‚
â”‚   â”œâ”€â”€ grpc/                                    # ğŸ¯ gRPC API å±‚ï¼ˆé«˜æ€§èƒ½ RPCï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ server.py                            # gRPC æœåŠ¡å™¨å¯åŠ¨
â”‚   â”‚   â”œâ”€â”€ dependencies.py                      # gRPC ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ protos/                              # Protocol Buffer å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ README.md                        # Proto æ–‡ä»¶è¯´æ˜
â”‚   â”‚   â”‚   â”œâ”€â”€ common.proto                     # é€šç”¨ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ document.proto                   # æ–‡æ¡£å¤„ç†æœåŠ¡å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ query.proto                      # æŸ¥è¯¢æœåŠ¡å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ generated/                           # è‡ªåŠ¨ç”Ÿæˆçš„ gRPC ä»£ç 
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ services/                            # gRPC æœåŠ¡å®ç°
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ document_service.py              # æ–‡æ¡£å¤„ç†æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ query_service.py                 # æŸ¥è¯¢æœåŠ¡
â”‚   â”‚   â””â”€â”€ interceptors/                        # gRPC æ‹¦æˆªå™¨
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ auth.py                          # è®¤è¯æ‹¦æˆªå™¨
â”‚   â”‚       â””â”€â”€ logging.py                       # æ—¥å¿—æ‹¦æˆªå™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ pipeline/                                # ğŸ¯ Pipeline æ¨¡å—ï¼ˆæ•°æ®å¤„ç†ï¼‰
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ workflows/                           # Prefect å·¥ä½œæµ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge_building.py            # çŸ¥è¯†åº“æ„å»ºå·¥ä½œæµ
â”‚   â”‚   â”‚   â””â”€â”€ document_processing.py           # æ–‡æ¡£å¤„ç†å·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ services/                            # Pipeline ä¸“ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ document/                        # æ–‡æ¡£å¤„ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ loader.py                    # æ–‡æ¡£åŠ è½½å™¨ï¼ˆ9+æ ¼å¼ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ downloader.py                # æ–‡æ¡£ä¸‹è½½å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ chunker.py                       # æ–‡æ¡£åˆ‡åˆ†æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ tagger.py                        # Atom æå–æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.py                       # LLM æç¤ºè¯ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ extractor.py                     # ä¿¡æ¯æå–æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ graph/                           # å›¾è°±æ„å»º
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ builder.py                   # å›¾è°±æ„å»ºæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ vector/                          # å‘é‡æ„å»º
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â””â”€â”€ builder.py                   # å‘é‡æ•°æ®åº“æ„å»º
â”‚   â”‚   â”œâ”€â”€ models/                              # Pipeline æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ document.py                      # æ–‡æ¡£æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ chunk.py                         # Chunk æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ atom.py                          # Atom æ¨¡å‹
â”‚   â”‚   â””â”€â”€ utils/                               # Pipeline å·¥å…·
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â””â”€â”€ text_processor.py                # æ–‡æœ¬å¤„ç†å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ retrieval/                               # ğŸ¯ æ£€ç´¢æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ workflows/                           # æ£€ç´¢å·¥ä½œæµ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ hybrid_retrieval.py              # æ··åˆæ£€ç´¢å·¥ä½œæµ
â”‚   â”‚   â”‚   â””â”€â”€ qa_pipeline.py                   # é—®ç­”å·¥ä½œæµ
â”‚   â”‚   â”œâ”€â”€ services/                            # æ£€ç´¢ä¸“ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ vector/                          # å‘é‡æ£€ç´¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ store.py                     # Qdrant å‘é‡æ£€ç´¢æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ graph_store.py                   # Neo4j å›¾è°±æ£€ç´¢æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ reranker.py                      # ç»“æœé‡æ’åºæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ models/                              # æ£€ç´¢æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ query.py                         # æŸ¥è¯¢è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ result.py                        # æ£€ç´¢ç»“æœæ¨¡å‹
â”‚   â”‚   â””â”€â”€ strategies/                          # æ£€ç´¢ç­–ç•¥
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ atom_retrieval.py                # Atom æ£€ç´¢ç­–ç•¥
â”‚   â”‚       â””â”€â”€ chunk_retrieval.py               # Chunk æ£€ç´¢ç­–ç•¥
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/                          # ğŸ¯ åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config/                              # é…ç½®ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ settings.py                      # é…ç½®ç±»ï¼ˆApollo + Pydantic Settingsï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ README.md                        # é…ç½®è¯´æ˜æ–‡æ¡£
â”‚   â”‚   â”œâ”€â”€ database/                            # æ•°æ®åº“è¿æ¥ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ qdrant.py                        # Qdrant å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ neo4j.py                         # Neo4j é©±åŠ¨
â”‚   â”‚   â”‚   â””â”€â”€ redis.py                         # Redis å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ llm/                                 # LLM ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ client.py                        # LLM å®¢æˆ·ç«¯å°è£…
â”‚   â”‚   â”‚   â””â”€â”€ embedder.py                      # Embedding æœåŠ¡ï¼ˆOpenAI + FastEmbedï¼‰
â”‚   â”‚   â”œâ”€â”€ pyapollo/                            # Apollo å®¢æˆ·ç«¯ï¼ˆè‡ªå®šä¹‰å®ç°ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ client.py                        # åŒæ­¥å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ async_client.py                  # å¼‚æ­¥å®¢æˆ·ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py                          # åŸºç¡€ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ settings.py                      # Apollo é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ exceptions.py                    # å¼‚å¸¸ç±»
â”‚   â”‚   â”‚   â””â”€â”€ config/                          # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ utils/                               # é€šç”¨å·¥å…·
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ logger.py                        # æ—¥å¿—é…ç½®å’Œå·¥å…·
â”‚   â”‚       â”œâ”€â”€ retry.py                         # é‡è¯•è£…é¥°å™¨
â”‚   â”‚       â””â”€â”€ metrics.py                       # æ€§èƒ½æŒ‡æ ‡æ”¶é›†
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                                  # å…¨å±€æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ api_models.py                        # API è¯·æ±‚/å“åº”æ¨¡å‹
â”‚   â”‚   â””â”€â”€ graph.py                             # å›¾è°±é€šç”¨æ¨¡å‹
â”‚   â”‚
â”‚   â””â”€â”€ utils/                                   # å…¨å±€å·¥å…·ç›®å½•
â”‚       â””â”€â”€ __init__.py
â”‚
â”œâ”€â”€ tests/                                       # æµ‹è¯•ï¼ˆæŒ‰æ¨¡å—ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api/                                     # API æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ test_routes.py
â”‚   â”œâ”€â”€ pipeline/                                # Pipeline æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_chunk.py
â”‚   â”‚   â”‚   â””â”€â”€ test_atom.py
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ document/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ test_loader.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_chunker.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_tagger.py
â”‚   â”‚   â”‚   â”œâ”€â”€ graph/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ test_builder.py
â”‚   â”‚   â”‚   â””â”€â”€ vector/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â””â”€â”€ test_builder.py
â”‚   â”‚   â””â”€â”€ workflows/
â”‚   â”‚       â””â”€â”€ __init__.py
â”‚   â”œâ”€â”€ retrieval/                               # æ£€ç´¢æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ vector/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â””â”€â”€ test_store.py
â”‚   â”‚   â”œâ”€â”€ strategies/
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”‚   â””â”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ test_strategies.py
â”‚   â”‚   â””â”€â”€ test_workflows.py
â”‚   â””â”€â”€ infrastructure/                          # åŸºç¡€è®¾æ–½æµ‹è¯•
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ test_settings.py
â”‚       â”œâ”€â”€ database/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ test_qdrant.py
â”‚       â”‚   â””â”€â”€ test_neo4j.py
â”‚       â”œâ”€â”€ llm/
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â””â”€â”€ test_embedder.py
â”‚       â””â”€â”€ utils/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ test_logger.py
â”‚           â””â”€â”€ test_metrics.py
â”‚
â”œâ”€â”€ docs/                                        # æ–‡æ¡£
â”‚   â”œâ”€â”€ PIKE-RAGç”Ÿäº§çº§å®ç°æ–¹æ¡ˆ.md
â”‚   â”œâ”€â”€ Apolloé…ç½®ç®¡ç†è¯¦è§£.md
â”‚   â”œâ”€â”€ å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£.md
â”‚   â””â”€â”€ ...
â”œâ”€â”€ main.py                                      # é¡¹ç›®æ ¹å…¥å£ï¼ˆå¯é€‰ï¼‰
â”œâ”€â”€ docker-compose.yml                           # Docker æœåŠ¡ç¼–æ’
â”œâ”€â”€ Dockerfile                                   # å®¹å™¨æ„å»ºæ–‡ä»¶
â”œâ”€â”€ pyproject.toml                               # Poetry ä¾èµ–ç®¡ç†
â”œâ”€â”€ requirements.txt                             # pip ä¾èµ–æ–‡ä»¶
â””â”€â”€ README.md                                    # é¡¹ç›®è¯´æ˜
```

### 7.3 æ¨¡å—èŒè´£è¯´æ˜

| æ¨¡å— | èŒè´£ | æ ¸å¿ƒæ–‡ä»¶ |
|------|------|---------|
| **api/** | HTTP RESTful æ¥å£å±‚ï¼ˆFastAPIï¼‰ï¼Œæä¾› Web æœåŠ¡ | `routes/*.py`, `dependencies.py` |
| **grpc/** | gRPC æ¥å£å±‚ï¼Œæä¾›é«˜æ€§èƒ½ RPC æœåŠ¡ | `server.py`, `services/*.py`, `protos/*.proto` |
| **pipeline/** | æ–‡æ¡£å¤„ç†å…¨æµç¨‹ï¼šåŠ è½½â†’åˆ‡åˆ†â†’æå–â†’å›¾è°±â†’å‘é‡åŒ–ï¼ˆPrefect Flowï¼‰ | `workflows/*.py`, `services/*.py` |
| **retrieval/** | æ£€ç´¢å…¨æµç¨‹ï¼šå‘é‡æ£€ç´¢â†’å›¾è°±æ£€ç´¢â†’æ··åˆâ†’é‡æ’ | `workflows/*.py`, `services/vector/store.py` |
| **infrastructure/** | åŸºç¡€è®¾æ–½å±‚ï¼šæ•°æ®åº“ã€LLMã€Embeddingã€Loggerã€Metricsï¼ˆæ— çŠ¶æ€ç®¡ç†ï¼‰ | `database/*.py`, `llm/*.py`, `utils/*.py` |
| **models/** | å…¨å±€é€šç”¨æ•°æ®æ¨¡å‹ | `api_models.py`, `graph.py` |

### 7.4 è°ƒç”¨å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP API    â”‚      â”‚  gRPC API    â”‚
â”‚ (FastAPI)    â”‚      â”‚   (gRPC)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pipeline    â”‚     â”‚   Retrieval   â”‚
â”‚     æ¨¡å—      â”‚     â”‚     æ¨¡å—      â”‚
â”‚ (Prefect)     â”‚     â”‚  (æ£€ç´¢ç­–ç•¥)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Infrastructure     â”‚
        â”‚     åŸºç¡€è®¾æ–½å±‚       â”‚
        â”‚ (DB/LLM/Embedding)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜**ï¼š
- HTTP API å’Œ gRPC API éƒ½å¯ä»¥è°ƒç”¨ Pipeline å’Œ Retrieval æ¨¡å—
- HTTP API é€‚åˆ Web åº”ç”¨å’Œç®¡ç†åå°
- gRPC API é€‚åˆå¾®æœåŠ¡é—´é€šä¿¡å’Œé«˜æ€§èƒ½åœºæ™¯

### 7.5 è®¾è®¡ä¼˜åŠ¿

âœ… **é«˜å†…èš**ï¼šæ¯ä¸ªæ¨¡å—åŒ…å«è‡ªå·±çš„ workflowsã€servicesã€models
âœ… **ä½è€¦åˆ**ï¼šæ¨¡å—é—´é€šè¿‡æ˜ç¡®çš„æ¥å£äº¤äº’
âœ… **æ˜“æ‰©å±•**ï¼šæ–°å¢åŠŸèƒ½åªéœ€åœ¨å¯¹åº”æ¨¡å—å†…æ·»åŠ 
âœ… **æ˜“æµ‹è¯•**ï¼šæµ‹è¯•ç»“æ„ä¸ä»£ç ç»“æ„ä¸€ä¸€å¯¹åº”
âœ… **æ¸…æ™°**ï¼šä¸€çœ¼å°±èƒ½çœ‹å‡ºé¡¹ç›®çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

---

## 8. å®æ–½è®¡åˆ’

### 8.1 å¼€å‘é˜¶æ®µ

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ | è¾“å‡º |
|------|------|------|------|
| **Phase 1** | ç¯å¢ƒæ­å»º | 1 å¤© | Docker Compose + Poetry ç¯å¢ƒ |
| **Phase 2** | é…ç½®ç®¡ç† | 1 å¤© | Apollo é›†æˆ + pydantic-settings |
| **Phase 3** | æ–‡æ¡£å¤„ç† | 2 å¤© | 9+ æ ¼å¼åŠ è½½å™¨ + åˆ‡åˆ†æœåŠ¡ |
| **Phase 4** | Atom æå– | 1 å¤© | LLM Atom æå–æœåŠ¡ |
| **Phase 5** | Embedding æœåŠ¡ | 1 å¤© | OpenAI + FastEmbed åŒæ¨¡å¼ |
| **Phase 6** | Qdrant é›†æˆ | 2 å¤© | å‘é‡å­˜å‚¨ + åŒå‘é‡æ•°æ®åº“ |
| **Phase 7** | Neo4j é›†æˆ | 2 å¤© | å›¾è°±æ„å»º + Cypher æŸ¥è¯¢ |
| **Phase 8** | Prefect Pipeline | 2 å¤© | æ–‡æ¡£å¤„ç† Flow + çŸ¥è¯†æ„å»º Flow |
| **Phase 9** | æ£€ç´¢æœåŠ¡ | 2 å¤© | å‘é‡æ£€ç´¢ + æ··åˆæ£€ç´¢ + é‡æ’åº |
| **Phase 10** | HTTP API å¼€å‘ | 2 å¤© | FastAPI RESTful æ¥å£ |
| **Phase 11** | gRPC API å¼€å‘ | 2 å¤© | Proto å®šä¹‰ + gRPC æœåŠ¡å®ç° |
| **Phase 12** | æµ‹è¯•ä¼˜åŒ– | 2 å¤© | å•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯• |
| **æ€»è®¡** | - | **20-22 å¤©** | ç”Ÿäº§çº§ç³»ç»Ÿ |

### 8.2 éƒ¨ç½²æµç¨‹

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repo>
cd pikee

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å†™ Apollo åœ°å€

# 3. å¯åŠ¨ Prefect Serverï¼ˆåå°ï¼‰
prefect server start &

# 4. ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 5. è®¿é—®æœåŠ¡
# HTTP API: http://localhost:8000/docs
# gRPC API: localhost:50051 (éœ€è¦ gRPC å®¢æˆ·ç«¯)
# Prefect UI: http://localhost:4200
# Neo4j: http://localhost:7474
# Qdrant: http://localhost:6333/dashboard
```

**æ³¨æ„**ï¼š
- HTTP API (FastAPI) å’Œ gRPC API å¯ä»¥åŒæ—¶è¿è¡Œæˆ–å•ç‹¬è¿è¡Œ
- HTTP API é€‚åˆ Web å‰ç«¯å’Œè°ƒè¯•
- gRPC API é€‚åˆå¾®æœåŠ¡é—´é€šä¿¡å’Œé«˜æ€§èƒ½åœºæ™¯


---

## 9. è¯¦ç»†æ–‡æ¡£ç´¢å¼•

### 9.1 æ¶æ„è®¾è®¡

- [æ–‡æ¡£å¤„ç†ä¸æ™ºèƒ½åˆ‡åˆ†è¯¦è§£](./æ–‡æ¡£å¤„ç†ä¸æ™ºèƒ½åˆ‡åˆ†è¯¦è§£.md) - Prefect Pipeline è®¾è®¡ä¸å®ç°
- [çŸ¥è¯†å›¾è°±åœ¨PIKE-RAGä¸­çš„åº”ç”¨è¯¦è§£](./çŸ¥è¯†å›¾è°±åœ¨PIKE-RAGä¸­çš„åº”ç”¨è¯¦è§£.md) - Neo4j å›¾æ¨¡å‹ä¸ Cypher æŸ¥è¯¢
- [ChunkAtomRetrieverè¯¦è§£](./ChunkAtomRetrieverè¯¦è§£.md) - åŒå‘é‡æ£€ç´¢ä¸æ··åˆæŸ¥è¯¢

### 9.2 æ ¸å¿ƒåŠŸèƒ½

- [æ–‡æ¡£å¤„ç†ä¸æ™ºèƒ½åˆ‡åˆ†è¯¦è§£](./æ–‡æ¡£å¤„ç†ä¸æ™ºèƒ½åˆ‡åˆ†è¯¦è§£.md) - 9+ æ ¼å¼æ”¯æŒ + LLM æ™ºèƒ½åˆ‡åˆ†
- [ChunkAtomRetrieverè¯¦è§£](./ChunkAtomRetrieverè¯¦è§£.md) - Atom æå– + åŒå‘é‡æ£€ç´¢
- [åŸºç¡€QAå·¥ä½œæµè¯¦è§£](./åŸºç¡€QAå·¥ä½œæµè¯¦è§£.md) - é—®ç­”ç”Ÿæˆæµç¨‹

### 9.3 å¯é æ€§ä¸é…ç½®

- [å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£](./å¯é æ€§å¢å¼ºæ–¹æ¡ˆè¯¦è§£.md) - é‡è¯•ã€é”™è¯¯å¤„ç†ã€å…œåº•
- [Apolloé…ç½®ç®¡ç†è¯¦è§£](./Apolloé…ç½®ç®¡ç†è¯¦è§£.md) - é›†ä¸­é…ç½®ä¸åŠ¨æ€åˆ·æ–°
- [æ—¥å¿—ä½¿ç”¨æŒ‡å—](./æ—¥å¿—ä½¿ç”¨æŒ‡å—.md) - Logger é…ç½®ä¸æœ€ä½³å®è·µ
- [ç›‘æ§ä¸å‘Šè­¦](./ç›‘æ§ä¸å‘Šè­¦.md) - Prometheus + Sentry

### 9.4 éƒ¨ç½²ä¸è¿ç»´

- [Dockeréƒ¨ç½²æŒ‡å—](./Dockeréƒ¨ç½²æŒ‡å—.md) - ä¸€é”®éƒ¨ç½²
- [ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–](./ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–.md) - æ€§èƒ½è°ƒä¼˜
- [å¸¸è§é—®é¢˜FAQ](./å¸¸è§é—®é¢˜FAQ.md) - æ•…éšœæ’æŸ¥

---

## 10. å¿«é€Ÿå¼€å§‹

### 10.1 æœ€å°å¯è¿è¡Œç¤ºä¾‹

1. **å®‰è£…ä¾èµ–**

```bash
poetry install
```

2. **å¯åŠ¨æœåŠ¡**

```bash
docker-compose up -d qdrant neo4j redis
```

3. **è¿è¡Œ HTTP APIï¼ˆFastAPIï¼‰**

```bash
poetry run python -m pikee.main
```

4. **è¿è¡Œ gRPC APIï¼ˆå¯é€‰ï¼‰**

```bash
# å•ç‹¬è¿è¡Œ gRPC æœåŠ¡å™¨
poetry run python -m pikee.grpc.server
```

5. **ä¸Šä¼ æ–‡æ¡£æ„å»ºçŸ¥è¯†åº“**

```bash
curl -X POST "http://localhost:8000/api/v1/knowledge/build" \
     -H "Content-Type: multipart/form-data" \
     -F "file=@sample.pdf"
```

6. **æŸ¥è¯¢é—®ç­”**

```bash
curl -X POST "http://localhost:8000/api/v1/query/ask" \
     -H "Content-Type: application/json" \
     -d '{"question": "ä»€ä¹ˆæ˜¯PIKE-RAGï¼Ÿ"}'
```

---

## 11. æ€»ç»“

### 11.1 æ ¸å¿ƒä¼˜åŠ¿

âœ… **ç”Ÿäº§çº§æ¶æ„**ï¼šPrefect + FastAPI + gRPC + Neo4j + Qdrant  
âœ… **ä¼ä¸šçº§ç¨³å®šæ€§**ï¼šPrefect å†…ç½®é‡è¯•ã€çŠ¶æ€æŒä¹…åŒ–ã€æ–­ç‚¹ç»­ä¼   
âœ… **åŒæ¥å£æ”¯æŒ**ï¼šHTTP RESTful + gRPC é«˜æ€§èƒ½ RPC  
âœ… **å®Œæ•´ç›‘æ§**ï¼šPrefect Web UI + ç»“æ„åŒ–æ—¥å¿— + Metrics  
âœ… **é…ç½®ä¸­å¿ƒ**ï¼šApollo é›†ä¸­ç®¡ç†ï¼ŒåŠ¨æ€åˆ·æ–°  
âœ… **åŒå‘é‡æ£€ç´¢**ï¼šChunk Store + Atom Store å¤šç²’åº¦æ£€ç´¢  
âœ… **æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ¸…æ™°çš„é¡¹ç›®ç»“æ„  
âœ… **å¼€ç®±å³ç”¨**ï¼šDocker Compose ä¸€é”®éƒ¨ç½²

### 11.2 é€‚ç”¨åœºæ™¯

- ä¼ä¸šçº§çŸ¥è¯†åº“ç³»ç»Ÿ
- æ™ºèƒ½å®¢æœé—®ç­”
- æ–‡æ¡£é—®ç­”åŠ©æ‰‹
- çŸ¥è¯†å›¾è°±æ£€ç´¢

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.1 (Prefect Pipeline)  
**Python ç‰ˆæœ¬**: 3.12+  
**æ¨èæŒ‡æ•°**: â­â­â­â­â­

**æ ¸å¿ƒæŠ€æœ¯æ ˆ**ï¼š
- æ¥å£å±‚ï¼šFastAPI (HTTP) + gRPC (RPC)
- å·¥ä½œæµç¼–æ’ï¼šPrefect 2.x
- å‘é‡æ•°æ®åº“ï¼šQdrantï¼ˆåŒå‘é‡å­˜å‚¨ï¼‰
- å›¾æ•°æ®åº“ï¼šNeo4j
- Embeddingï¼šOpenAI + FastEmbedï¼ˆå¯åˆ‡æ¢ï¼‰
- é…ç½®ä¸­å¿ƒï¼šApollo

å¦‚éœ€è¯¦ç»†å®ç°ï¼Œè¯·å‚è€ƒ[è¯¦ç»†æ–‡æ¡£ç´¢å¼•](#9-è¯¦ç»†æ–‡æ¡£ç´¢å¼•)ã€‚

