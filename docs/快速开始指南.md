# PIKE-RAG 快速开始指南

> 5 分钟快速部署和测试

---

## 1. 环境要求

- **Python**: 3.12+
- **Docker**: 20.10+
- **Docker Compose**: 2.0+
- **可用内存**: 8GB+

---

## 2. 快速部署

### 2.1 克隆项目

```bash
git clone <your-repo-url>
cd pike_rag_v2
```

### 2.2 配置环境变量

```bash
# 复制配置模板
cp .env.example .env

# 编辑配置文件
vim .env
```

最小配置（使用本地开发模式）：

```bash
# .env
LOCAL_DEV_MODE=true
OPENAI_API_KEY=sk-your-key-here
```

### 2.3 启动服务

```bash
# 一键启动所有依赖服务
docker-compose up -d

# 查看服务状态
docker-compose ps
```

服务启动后访问：
- **API文档**: http://localhost:8000/docs
- **Neo4j浏览器**: http://localhost:7474 (neo4j/password123)
- **Qdrant仪表板**: http://localhost:6333/dashboard

### 2.4 安装 Python 依赖

```bash
# 安装 Poetry（如果没有）
curl -sSL https://install.python-poetry.org | python3 -

# 安装依赖
poetry install

# 激活虚拟环境
poetry shell
```

### 2.5 启动 API 服务

```bash
# 开发模式（热重载）
poetry run python -m app.main

# 或使用 uvicorn
poetry run uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

---

## 3. 测试示例

### 3.1 上传文档构建知识库

**方式 1：使用 curl**

```bash
curl -X POST "http://localhost:8000/api/v1/knowledge/build" \
     -H "Content-Type: multipart/form-data" \
     -F "file=@sample.pdf"
```

**方式 2：使用 Python**

```python
import httpx

with open("sample.pdf", "rb") as f:
    response = httpx.post(
        "http://localhost:8000/api/v1/knowledge/build",
        files={"file": f}
    )

print(response.json())
# 输出: {"task_id": "xxx", "status": "pending", "message": "..."}
```

**方式 3：使用 Swagger UI**

访问 http://localhost:8000/docs，找到 `POST /api/v1/knowledge/build`，点击"Try it out"上传文件。

### 3.2 查询任务状态

```bash
# 替换为实际的 task_id
curl "http://localhost:8000/api/v1/knowledge/build/{task_id}"
```

### 3.3 问答查询

```bash
curl -X POST "http://localhost:8000/api/v1/query/ask" \
     -H "Content-Type: application/json" \
     -d '{
       "question": "什么是 PIKE-RAG？",
       "retrieval_method": "hybrid"
     }'
```

响应示例：

```json
{
  "question": "什么是 PIKE-RAG？",
  "answer": "PIKE-RAG 是一个基于知识图谱的检索增强生成系统...",
  "references": [
    {
      "chunk_id": "doc1_chunk_0001",
      "content": "...",
      "score": 0.92,
      "source_document": "sample.pdf"
    }
  ]
}
```

### 3.4 查询知识图谱

```bash
# 获取实体的子图
curl "http://localhost:8000/api/v1/graph/subgraph/PIKE-RAG?depth=2"

# 查找两个实体之间的路径
curl "http://localhost:8000/api/v1/graph/path/Entity1/Entity2"
```

---

## 4. 验证部署

### 4.1 检查服务健康状态

```bash
# API 健康检查
curl http://localhost:8000/health

# Qdrant
curl http://localhost:6333

# Neo4j（需要认证）
curl -u neo4j:password123 http://localhost:7474
```

### 4.2 查看日志

```bash
# API 服务日志
docker-compose logs -f api

# Qdrant 日志
docker-compose logs -f qdrant

# Neo4j 日志
docker-compose logs -f neo4j
```

### 4.3 数据验证

**检查 Qdrant 集合**

```python
from qdrant_client import QdrantClient

client = QdrantClient(url="http://localhost:6333")
collections = client.get_collections()
print(collections)
# 应该看到 pike_chunks 和 pike_atoms
```

**检查 Neo4j 图谱**

访问 http://localhost:7474，执行 Cypher 查询：

```cypher
// 查看所有文档
MATCH (d:Document) RETURN d LIMIT 10

// 查看 Chunk-Atom 关系
MATCH (c:Chunk)-[:HAS_ATOM]->(a:Atom) RETURN c, a LIMIT 20
```

---

## 5. 常见问题

### 5.1 端口被占用

**现象**: `docker-compose up` 报错端口冲突

**解决**:
```bash
# 修改 docker-compose.yml 中的端口映射
ports:
  - "8001:8000"  # 改为其他端口
```

### 5.2 OpenAI API 连接失败

**现象**: 上传文档后 Atom 提取失败

**解决**:
1. 检查 `OPENAI_API_KEY` 是否正确
2. 检查 `OPENAI_API_BASE` 是否可访问
3. 如果使用代理，设置环境变量：
   ```bash
   export HTTP_PROXY=http://your-proxy:port
   export HTTPS_PROXY=http://your-proxy:port
   ```

### 5.3 Neo4j 连接失败

**现象**: API 报错 "Failed to connect to Neo4j"

**解决**:
```bash
# 检查 Neo4j 是否启动
docker-compose ps neo4j

# 查看 Neo4j 日志
docker-compose logs neo4j

# 重启 Neo4j
docker-compose restart neo4j
```

### 5.4 文档上传失败

**现象**: 返回 "Unsupported file type"

**解决**:
- 检查文件格式是否支持（PDF/DOCX/XLSX/PPTX/MD/JSON/TXT）
- 检查文件大小是否超过限制（默认 50MB）
- 检查文件是否损坏

---

## 6. 下一步

### 6.1 了解架构

- 阅读 [PIKE-RAG生产级实现方案](./PIKE-RAG生产级实现方案.md)
- 查看 [LangGraph工作流实现详解](./LangGraph工作流实现详解.md)

### 6.2 配置 Apollo

- 参考 [Apollo配置管理详解](./Apollo配置管理详解.md)
- 从本地开发模式迁移到 Apollo

### 6.3 生产部署

- 阅读 [Docker部署指南](./Docker部署指南.md)
- 配置监控和告警

### 6.4 开发定制

- 自定义 Atom 提取逻辑
- 扩展文档加载器
- 优化检索策略

---

## 7. 获取帮助

- **文档**: 查看 `docs/guides/` 目录下的详细文档
- **示例代码**: 查看 `examples/` 目录
- **问题反馈**: 提交 GitHub Issue

---

**版本**: 1.0  
**更新时间**: 2025年

